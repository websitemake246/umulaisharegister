<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medarasatul Islam ¬∑ ŸÜŸàÿ± multi-class with form inputs (no popups)</title>
    <!-- Google Fonts (Cairo + Space Grotesk) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600&display=swap" rel="stylesheet">
    <!-- Font Awesome 6 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Space Grotesk', 'Cairo', sans-serif;
            background: linear-gradient(145deg, #0a2f2f 0%, #1b4e4e 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1.5rem;
            color: #f5f2e7;
            position: relative;
        }

        body::before {
            content: "";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" opacity="0.06"><path d="M25,25 L50,0 L75,25 L50,50 Z" fill="none" stroke="%23d4af37" stroke-width="0.8"/><path d="M25,75 L50,50 L75,75 L50,100 Z" fill="none" stroke="%23d4af37" stroke-width="0.8"/><circle cx="50" cy="50" r="18" fill="none" stroke="%23d4af37" stroke-width="0.8"/></svg>');
            background-size: 80px 80px;
            pointer-events: none;
            z-index: 0;
        }

        .register-card {
            width: 100%;
            max-width: 1400px;
            background: rgba(18, 38, 38, 0.85);
            backdrop-filter: blur(14px);
            border-radius: 3rem;
            border: 1px solid rgba(212, 175, 55, 0.5);
            box-shadow: 0 30px 60px -10px #000, 0 0 0 1px #d4af3740;
            padding: 2rem 2rem 2.5rem;
            z-index: 2;
        }

        /* header */
        .madrasa-header {
            display: flex; align-items: center; justify-content: space-between;
            margin-bottom: 2rem; flex-wrap: wrap; gap: 1.5rem;
            border-bottom: 2px dashed #d4af37; padding-bottom: 1.5rem;
        }
        .title-section { display: flex; align-items: center; gap: 1rem; }
        .crescent-icon { font-size: 3rem; color: #d4af37; filter: drop-shadow(0 0 8px #f1c40f); }
        .title-section h1 {
            font-size: 2.4rem; font-weight: 700; line-height: 1.2;
            background: linear-gradient(135deg, #fcf3cf, #d4af37); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .title-section h1 span { font-size: 1.2rem; display: block; color: #c1ad7a; -webkit-text-fill-color: #c1ad7a; }
        .date-box { background: rgba(0,0,0,0.4); border: 1px solid #d4af37; border-radius: 60px; padding: 0.8rem 2rem; display: flex; align-items: center; gap: 12px; font-size: 1.3rem; }
        .date-box i { color: #f1c40f; }

        /* login */
        .login-container { max-width: 450px; margin: 1rem auto 2rem; }
        .login-glass { background: rgba(255,255,255,0.03); border: 1px solid #d4af3740; border-radius: 3rem; padding: 2.2rem 2rem; backdrop-filter: blur(8px); }
        .login-header { display: flex; justify-content: center; gap: 10px; font-size: 2rem; color: #d4af37; margin-bottom: 2rem; }
        .input-field { position: relative; margin-bottom: 1.8rem; }
        .input-field i { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); color: #d4af37; font-size: 1.3rem; width: 28px; }
        .input-field input { width: 100%; background: rgba(255,255,255,0.05); border: 1px solid #3f5e5e; border-radius: 60px; padding: 1.2rem 1.2rem 1.2rem 3.5rem; font-size: 1.2rem; color: #f5f2e7; outline: none; }
        .input-field input:focus { border-color: #d4af37; box-shadow: 0 0 20px #d4af3760; }
        .login-btn {
            background: linear-gradient(125deg, #1e5f5f, #123b3b); border: 1px solid #d4af37; border-radius: 60px; padding: 1.2rem; width: 100%; font-size: 1.5rem; font-weight: 700; color: #f1e5c9;
            display: flex; align-items: center; justify-content: center; gap: 15px; cursor: pointer; transition: 0.2s;
        }
        .login-btn:hover { background: #1e6b6b; border-color: #f1c40f; box-shadow: 0 0 30px #d4af37; }
        .demo-note { text-align: center; margin-top: 1.5rem; color: #afc5c5; background: rgba(0,0,0,0.3); border-radius: 40px; padding: 0.7rem; border: 1px dashed #6f8f8f; }
        .highlight { color: #d4af37; }

        /* main register */
        .register-content { display: none; animation: fadeSlide 0.5s ease; }
        @keyframes fadeSlide { 0% { opacity: 0; transform: translateY(15px); } 100% { opacity: 1; transform: translateY(0); } }

        /* control bar */
        .control-bar {
            display: flex; flex-wrap: wrap; gap: 1rem; align-items: center; justify-content: space-between;
            background: #102d2d; border-radius: 70px; padding: 0.8rem 1.8rem; margin-bottom: 2rem; border: 1px solid #b99b4b;
        }
        .date-picker { display: flex; align-items: center; gap: 15px; }
        .cool-date-input { background: #1e4242; border: 1px solid #d4af37; border-radius: 40px; padding: 0.7rem 1.5rem; font-size: 1.2rem; color: white; outline: none; }
        .class-selector { display: flex; align-items: center; gap: 10px; background: #1e4242; border-radius: 60px; padding: 0.3rem 0.8rem; border: 1px solid #d4af37; }
        .class-selector select { background: transparent; border: none; color: white; font-size: 1.2rem; padding: 0.6rem 1rem; outline: none; }
        .stats-badge { display: flex; gap: 15px; }
        .stat-item { background: #1f4a4a; border-radius: 40px; padding: 0.5rem 1.5rem; font-weight: 600; border: 1px solid #a48b4b; }

        /* teacher card */
        .teacher-section {
            background: #1d3a3a; border-radius: 70px; padding: 1.2rem 2rem; margin-bottom: 2rem; border: 1px solid #d4af37;
            display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 1rem;
        }
        .teacher-avatar { display: flex; align-items: center; gap: 20px; }
        .teacher-avatar .default-avatar { width: 70px; height: 70px; border-radius: 50%; background: #d4af37; display: flex; align-items: center; justify-content: center; font-size: 2.2rem; color: #0a2f2f; font-weight: 700; }
        .teacher-info h3 { font-size: 1.8rem; color: #ecd47c; }
        .teacher-info p { color: #b9c5a3; }

        /* add student - now using form input, not prompt */
        .add-student-row {
            display: flex; gap: 1rem; align-items: center; background: #1d3a3a; border-radius: 70px; padding: 1rem 2rem; margin-bottom: 2rem; border: 1px solid #d4af37; flex-wrap: wrap;
        }
        .add-student-row input { 
            flex: 2; min-width: 250px; background: #0d2b2b; border: 1px solid #8f9f6f; border-radius: 60px; padding: 1rem 1.5rem; font-size: 1.2rem; color: white; outline: none; 
        }
        .add-student-row input:focus { border-color: #f1c40f; }
        .cool-add-btn { 
            background: #d4af37; border: none; color: #0a2f2f; font-weight: 700; padding: 1rem 2.2rem; border-radius: 60px; font-size: 1.2rem; display: flex; align-items: center; gap: 10px; cursor: pointer;
            transition: 0.2s;
        }
        .cool-add-btn:hover { background: #e5c356; box-shadow: 0 0 20px #f1c40f; }

        /* student grid */
        .students-header { display: flex; justify-content: space-between; margin-bottom: 1rem; }
        .students-header h2 { font-size: 2rem; color: #ecd47c; }
        .student-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1rem;
            max-height: 400px; overflow-y: auto; padding: 0.5rem; margin-bottom: 2rem;
            scrollbar-width: thin; scrollbar-color: #d4af37 #1b4e4e;
        }
        .student-grid::-webkit-scrollbar { width: 8px; }
        .student-grid::-webkit-scrollbar-track { background: #1b4e4e; border-radius: 10px; }
        .student-grid::-webkit-scrollbar-thumb { background: #d4af37; border-radius: 10px; }

        .student-card {
            background: rgba(44, 74, 74, 0.7); border: 1px solid #85723f; border-radius: 2rem; padding: 1rem 1.2rem;
            display: flex; align-items: center; justify-content: space-between; transition: 0.2s;
        }
        .student-card:hover { border-color: #f1c40f; background: #2f5f5f; }
        .student-info { display: flex; align-items: center; gap: 15px; overflow: hidden; }
        .student-avatar { width: 44px; height: 44px; background: #d4af37; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.6rem; color: #0a2f2f; font-weight: 700; flex-shrink: 0; }
        .student-name { font-size: 1.3rem; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .attendance-toggle { display: flex; gap: 5px; align-items: center; }
        .toggle-btn { background: transparent; border: 1.5px solid #6b8f8f; color: #dbcaa3; width: 42px; height: 42px; border-radius: 30px; font-size: 1.3rem; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .toggle-btn.present-active { background: #0f6b4b; border-color: #2ecc71; color: white; box-shadow: 0 0 15px #2ecc71; }
        .toggle-btn.absent-active { background: #8b4c4c; border-color: #e74c3c; color: white; box-shadow: 0 0 15px #e74c3c; }
        .delete-btn { background: transparent; border: 1px solid #b36b6b; color: #f3a7a7; width: 38px; height: 38px; border-radius: 40px; font-size: 1.1rem; margin-left: 6px; cursor: pointer; }
        .delete-btn:hover { background: #b33f3f; color: white; }

        /* saved registers panel */
        .saved-registers {
            background: #102d2d; border-radius: 2rem; padding: 1.5rem; margin-bottom: 2rem; border: 1px solid #d4af37;
        }
        .saved-header { display: flex; align-items: center; gap: 15px; margin-bottom: 1rem; }
        .saved-header h3 { color: #ecd47c; font-size: 1.8rem; }
        .register-list {
            display: flex; flex-wrap: wrap; gap: 1rem; max-height: 150px; overflow-y: auto; padding: 0.5rem;
        }
        .register-item {
            background: #1f4a4a; border: 1px solid #d4af37; border-radius: 60px; padding: 0.7rem 1.5rem;
            display: flex; align-items: center; gap: 15px; cursor: pointer; transition: 0.2s;
        }
        .register-item:hover { background: #2f6b6b; transform: scale(1.02); }
        .register-item i { color: #f1c40f; }

        /* action bar */
        .action-bar { display: flex; flex-wrap: wrap; justify-content: flex-end; gap: 20px; margin-top: 2rem; }
        .save-btn, .pdf-btn, .view-btn {
            background: #d4af37; border: none; color: #0a2f2f; font-size: 1.3rem; font-weight: 600; padding: 0.9rem 2rem; border-radius: 60px; display: flex; align-items: center; gap: 15px; cursor: pointer;
        }
        .pdf-btn { background: #1e5f5f; border: 1px solid #d4af37; color: #f1e5c9; }
        .view-btn { background: #2f5f5f; border: 1px solid #d4af37; color: #f1e5c9; }
        .logout-btn-small { background: rgba(0,0,0,0.3); border: 1px solid #b99b4b; border-radius: 60px; padding: 0.9rem 2rem; font-size: 1.2rem; color: #e0d2ae; display: flex; align-items: center; gap: 12px; cursor: pointer; }
        .footer-note { margin-top: 2rem; text-align: center; color: #afc5c5; }
    </style>
</head>
<body>
    <div class="register-card">
        <!-- header -->
        <div class="madrasa-header">
            <div class="title-section">
                <div class="crescent-icon"><i class="fas fa-moon"></i></div>
                <h1>ŸÖÿØÿ±ÿ≥ÿ© ŸÖÿØÿ±ÿ≥ÿ© ÿßŸÑÿ•ÿ≥ŸÑÿßŸÖ<br><span>Medarasatul Islam ¬∑ form input (no popups)</span></h1>
            </div>
            <div class="date-box" id="globalDateDisplay"><i class="fas fa-calendar-alt"></i><span>loading...</span></div>
        </div>

        <!-- LOGIN BLOCK -->
        <div id="loginBlock" class="login-container">
            <div class="login-glass">
                <div class="login-header"><i class="fas fa-lock"></i><i class="fas fa-key"></i></div>
                <div class="input-field"><i class="fas fa-user"></i><input type="text" id="username" value="Khalid" placeholder="Username"></div>
                <div class="input-field"><i class="fas fa-lock"></i><input type="password" id="password" value="Hassan" placeholder="Password"></div>
                <button class="login-btn" id="loginBtn"><i class="fas fa-sign-in-alt"></i> Enter register</button>
                <div class="demo-note"><i class="fas fa-star"></i> Use <span class="highlight">Khalid</span> / <span class="highlight">Hassan</span></div>
            </div>
        </div>

        <!-- MAIN REGISTER -->
        <div id="registerContent" class="register-content">
            <!-- control bar -->
            <div class="control-bar">
                <div class="date-picker">
                    <i class="fas fa-calendar-plus"></i>
                    <input type="date" id="attendanceDate" class="cool-date-input">
                </div>
                <div class="class-selector">
                    <i class="fas fa-chalkboard-teacher"></i>
                    <select id="classSelect">
                        <option value="class1">Class 1 - Mallam Khalid</option>
                        <option value="class2">Class 2 - Mallam Hassan</option>
                        <option value="class3">Class 3 - Ustadh Bilal</option>
                        <option value="class4">Class 4 - Ustadha Fatima</option>
                        <option value="class5">Class 5 - Ustadh Yusuf</option>
                    </select>
                </div>
                <div class="stats-badge">
                    <span class="stat-item" id="presentCount">‚úÖ 0</span>
                    <span class="stat-item" id="absentCount">‚ùå 0</span>
                    <span class="stat-item" id="totalCount">total 0</span>
                </div>
            </div>

            <!-- teacher card -->
            <div class="teacher-section" id="teacherCard">
                <div class="teacher-avatar" id="teacherAvatar"></div>
                <div class="teacher-info" id="teacherInfo">
                    <h3 id="teacherName">Ustadh Ahmed</h3>
                    <p id="teacherDesc"><i class="fas fa-star"></i> Class 1 ¬∑ Islamic Studies</p>
                </div>
                <div><i class="fas fa-id-card" style="color:#d4af37; font-size:2rem;"></i></div>
            </div>

            <!-- add student row - using INPUT FIELD, not prompt -->
            <div class="add-student-row">
                <input type="text" id="newStudentName" placeholder="Enter new student name (e.g. Aisha bint Abi Bakr)">
                <button class="cool-add-btn" id="addStudentBtn"><i class="fas fa-plus-circle"></i> Add to this class</button>
            </div>

            <!-- student grid -->
            <div class="students-header">
                <h2><i class="fas fa-users"></i> <span id="currentClassName">Class 1</span> ¬∑ students</h2>
            </div>
            <div class="student-grid" id="studentGrid"></div>

            <!-- SAVED REGISTERS SECTION -->
            <div class="saved-registers">
                <div class="saved-header">
                    <i class="fas fa-archive" style="color:#d4af37; font-size:2rem;"></i>
                    <h3>üìÅ Saved Registers (click to view)</h3>
                </div>
                <div class="register-list" id="registerList">
                    <!-- dynamically populated -->
                </div>
                <p style="margin-top:0.8rem; color:#a5b8b8;"><i class="fas fa-info-circle"></i> Click any saved register to view that day's attendance. Then download PDF.</p>
            </div>

            <!-- action buttons -->
            <div class="action-bar">
                <button class="logout-btn-small" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Log out</button>
                <button class="view-btn" id="refreshRegistersBtn"><i class="fas fa-sync-alt"></i> Refresh list</button>
                <button class="pdf-btn" id="downloadPdfBtn"><i class="fas fa-file-pdf"></i> PDF current</button>
                <button class="save-btn" id="markAllPresent"><i class="fas fa-check-circle"></i> All present</button>
                <button class="save-btn" id="saveAttendance"><i class="fas fa-save"></i> Save this register</button>
            </div>
            <div class="footer-note"><i class="fas fa-hands"></i> Every day is witnessed ¬∑ Alhamdulillah <i class="fas fa-hands"></i></div>
        </div>
    </div>

    <script>
        (function() {
            const VALID_USER = "Khalid", VALID_PASS = "Hassan";

            // DOM elements
            const loginBlock = document.getElementById('loginBlock');
            const registerContent = document.getElementById('registerContent');
            const loginBtn = document.getElementById('loginBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            const usernameInp = document.getElementById('username');
            const passwordInp = document.getElementById('password');
            const attendanceDate = document.getElementById('attendanceDate');
            const globalDateSpan = document.querySelector('#globalDateDisplay span');
            const classSelect = document.getElementById('classSelect');
            const teacherAvatar = document.getElementById('teacherAvatar');
            const teacherName = document.getElementById('teacherName');
            const teacherDesc = document.getElementById('teacherDesc');
            const currentClassNameSpan = document.getElementById('currentClassName');
            const studentGrid = document.getElementById('studentGrid');
            const presentSpan = document.getElementById('presentCount');
            const absentSpan = document.getElementById('absentCount');
            const totalSpan = document.getElementById('totalCount');
            const markAllPresentBtn = document.getElementById('markAllPresent');
            const saveBtn = document.getElementById('saveAttendance');
            const addStudentBtn = document.getElementById('addStudentBtn');
            const newStudentName = document.getElementById('newStudentName');
            const downloadPdfBtn = document.getElementById('downloadPdfBtn');
            const registerList = document.getElementById('registerList');
            const refreshRegistersBtn = document.getElementById('refreshRegistersBtn');

            // teacher data
            const teachers = {
                class1: { name: 'Ustadh Ahmed', desc: 'Class 1 ¬∑ Quran & Tafseer', img: 'üë®‚Äçüè´', color: '#d4af37' },
                class2: { name: 'Ustadha Aisha', desc: 'Class 2 ¬∑ Arabic & Fiqh', img: 'üë©‚Äçüè´', color: '#c9a84b' },
                class3: { name: 'Ustadh Bilal', desc: 'Class 3 ¬∑ Seerah & Akhlaq', img: 'üßï', color: '#b5923a' },
                class4: { name: 'Ustadha Fatima', desc: 'Class 4 ¬∑ Tajweed & Duas', img: 'üë≥‚Äç‚ôÄÔ∏è', color: '#d4af37' },
                class5: { name: 'Ustadh Yusuf', desc: 'Class 5 ¬∑ Islamic History', img: 'üë≥‚Äç‚ôÇÔ∏è', color: '#c7a445' }
            };

            // data
            let classesData = { class1: [], class2: [], class3: [], class4: [], class5: [] };
            let savedRegisters = [];

            // load from localStorage
            function loadAll() {
                const storedClasses = localStorage.getItem('madrasaClasses');
                if (storedClasses) {
                    try { classesData = JSON.parse(storedClasses); }
                    catch { setDefaultClasses(); }
                } else { setDefaultClasses(); }

                const storedRegisters = localStorage.getItem('savedAttendanceRegisters');
                if (storedRegisters) {
                    try { savedRegisters = JSON.parse(storedRegisters); }
                    catch { savedRegisters = []; }
                } else { savedRegisters = []; }

                saveAllClasses();
                saveAllRegisters();
            }

            function setDefaultClasses() {
                classesData = {
                    class1: [ { id: 101, name: 'Yusuf ibn Tariq', avatar: 'Ÿä', present: false }, { id: 102, name: 'Aisha bint Khalid', avatar: 'ÿπ', present: false } ],
                    class2: [ { id: 201, name: 'Omar al-Farooq', avatar: 'ÿπ', present: false }, { id: 202, name: 'Fatima az-Zahra', avatar: 'ŸÅ', present: false } ],
                    class3: [ { id: 301, name: 'Bilal al-Habashi', avatar: 'ÿ®', present: false }, { id: 302, name: 'Zaynab bint Jahsh', avatar: 'ÿ≤', present: false } ],
                    class4: [ { id: 401, name: 'Hamza ibn Abdul-Muttalib', avatar: 'ÿ≠', present: false }, { id: 402, name: 'Khadijah al-Kubra', avatar: 'ÿÆ', present: false } ],
                    class5: [ { id: 501, name: 'Abdullah ibn Umar', avatar: 'ÿπ', present: false }, { id: 502, name: 'Safiyya bint Huyayy', avatar: 'ÿµ', present: false } ]
                };
            }

            function saveAllClasses() {
                localStorage.setItem('madrasaClasses', JSON.stringify(classesData));
            }
            function saveAllRegisters() {
                localStorage.setItem('savedAttendanceRegisters', JSON.stringify(savedRegisters));
            }

            function getCurrentClass() { return classSelect.value; }
            function getCurrentStudents() { return classesData[getCurrentClass()] || []; }
            function updateCurrentStudents(newList) { classesData[getCurrentClass()] = newList; saveAllClasses(); }

            function renderTeacherCard() {
                const cls = getCurrentClass();
                const t = teachers[cls];
                teacherAvatar.innerHTML = `<div class="default-avatar" style="background: ${t.color};">${t.img}</div>`;
                teacherName.innerText = t.name;
                teacherDesc.innerHTML = `<i class="fas fa-star"></i> ${t.desc}`;
                currentClassNameSpan.innerText = cls.replace('class', 'Class ');
            }

            function renderStudentGrid() {
                const students = getCurrentStudents();
                let html = '';
                students.forEach(s => {
                    const presentActive = s.present ? 'present-active' : '';
                    const absentActive = !s.present ? 'absent-active' : '';
                    html += `
                        <div class="student-card" data-id="${s.id}">
                            <div class="student-info">
                                <div class="student-avatar">${s.avatar}</div>
                                <span class="student-name" title="${s.name}">${s.name}</span>
                            </div>
                            <div style="display: flex; gap: 3px;">
                                <button class="toggle-btn present-toggle ${presentActive}" data-action="present"><i class="fas fa-check"></i></button>
                                <button class="toggle-btn absent-toggle ${absentActive}" data-action="absent"><i class="fas fa-times"></i></button>
                                <button class="delete-btn" data-action="delete"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>
                    `;
                });
                studentGrid.innerHTML = html;
                attachStudentEvents();
                updateCounts();
            }

            function attachStudentEvents() {
                document.querySelectorAll('.present-toggle').forEach(btn => {
                    btn.addEventListener('click', e => {
                        const card = btn.closest('.student-card');
                        const id = Number(card.dataset.id);
                        togglePresent(id, true);
                    });
                });
                document.querySelectorAll('.absent-toggle').forEach(btn => {
                    btn.addEventListener('click', e => {
                        const card = btn.closest('.student-card');
                        const id = Number(card.dataset.id);
                        togglePresent(id, false);
                    });
                });
                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', e => {
                        const card = btn.closest('.student-card');
                        const id = Number(card.dataset.id);
                        deleteStudent(id);
                    });
                });
            }

            function togglePresent(id, isPresent) {
                const students = getCurrentStudents();
                const student = students.find(s => s.id === id);
                if (student) student.present = isPresent;
                saveAllClasses();
                renderStudentGrid();
            }

            function deleteStudent(id) {
                if (!confirm('Remove student?')) return;
                const cls = getCurrentClass();
                classesData[cls] = classesData[cls].filter(s => s.id !== id);
                saveAllClasses();
                renderStudentGrid();
            }

            function updateCounts() {
                const students = getCurrentStudents();
                const total = students.length;
                const present = students.filter(s => s.present).length;
                presentSpan.innerText = `‚úÖ ${present}`;
                absentSpan.innerText = `‚ùå ${total - present}`;
                totalSpan.innerText = `total ${total}`;
            }

            function markAllPresent() {
                const cls = getCurrentClass();
                classesData[cls].forEach(s => s.present = true);
                saveAllClasses();
                renderStudentGrid();
            }

            // SAVE attendance - using the input field, no prompt
            function saveCurrentRegister() {
                const date = attendanceDate.value;
                if (!date) { alert('Please select a date'); return; }
                const cls = getCurrentClass();
                const teacher = teachers[cls];
                const students = getCurrentStudents();
                const snapshot = students.map(s => ({ name: s.name, present: s.present }));
                const register = {
                    id: Date.now() + Math.random(),
                    date: date,
                    classKey: cls,
                    teacherName: teacher.name,
                    students: snapshot
                };
                savedRegisters.push(register);
                saveAllRegisters();
                renderRegisterList();
                alert(`üìå Register for ${date} (${teacher.name}) saved permanently.`);
            }

            function renderRegisterList() {
                if (savedRegisters.length === 0) {
                    registerList.innerHTML = '<div style="color:#a5b8b8;">No saved registers yet.</div>';
                    return;
                }
                const sorted = [...savedRegisters].sort((a,b) => b.date.localeCompare(a.date));
                let html = '';
                sorted.forEach(reg => {
                    html += `
                        <div class="register-item" data-reg-id="${reg.id}">
                            <i class="fas fa-calendar-check"></i>
                            <span>${reg.date} ¬∑ ${reg.teacherName}</span>
                            <i class="fas fa-eye" style="margin-left:10px;"></i>
                        </div>
                    `;
                });
                registerList.innerHTML = html;
                document.querySelectorAll('.register-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        const id = Number(item.dataset.regId);
                        const register = savedRegisters.find(r => r.id === id);
                        if (register) displaySavedRegister(register);
                    });
                });
            }

            function displaySavedRegister(register) {
                classSelect.value = register.classKey;
                renderTeacherCard();
                const students = register.students;
                let html = '';
                students.forEach(s => {
                    const statusClass = s.present ? 'present-active' : 'absent-active';
                    const icon = s.present ? '<i class="fas fa-check"></i>' : '<i class="fas fa-times"></i>';
                    html += `
                        <div class="student-card" style="border-left: 6px solid ${s.present ? '#2ecc71' : '#e74c3c'};">
                            <div class="student-info">
                                <div class="student-avatar">${s.name.charAt(0).toUpperCase()}</div>
                                <span class="student-name" title="${s.name}">${s.name}</span>
                            </div>
                            <div class="attendance-toggle">
                                <span class="toggle-btn ${statusClass}" style="cursor:default; width:auto; padding:0 15px;">${icon} ${s.present ? 'Present' : 'Absent'}</span>
                            </div>
                        </div>
                    `;
                });
                studentGrid.innerHTML = html;
                presentSpan.innerText = `‚úÖ ${students.filter(s => s.present).length}`;
                absentSpan.innerText = `‚ùå ${students.filter(s => !s.present).length}`;
                totalSpan.innerText = `total ${students.length}`;
            }

            function refreshToCurrentClass() {
                renderTeacherCard();
                renderStudentGrid();
            }

            function downloadPDF() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const cls = getCurrentClass();
                const t = teachers[cls];
                const date = attendanceDate.value || '____';
                const cards = document.querySelectorAll('#studentGrid .student-card');
                let presentNames = [], absentNames = [];
                cards.forEach(card => {
                    const nameSpan = card.querySelector('.student-name');
                    const name = nameSpan ? nameSpan.innerText : 'unknown';
                    const statusSpan = card.querySelector('.toggle-btn');
                    if (statusSpan) {
                        if (statusSpan.classList.contains('present-active')) presentNames.push(name);
                        else absentNames.push(name);
                    } else {
                        if (card.innerHTML.includes('‚úÖ Present')) presentNames.push(name);
                        else absentNames.push(name);
                    }
                });

                doc.setFont('helvetica', 'bold');
                doc.setFontSize(18);
                doc.setTextColor(190, 145, 60);
                doc.text('Medarasatul Islam', 20, 20);
                doc.setFontSize(14);
                doc.setTextColor(220,220,220);
                doc.text(`${t.name} ¬∑ ${date}`, 20, 35);
                doc.setFontSize(12);
                doc.setTextColor(200,180,120);
                doc.text(`Total: ${cards.length}  |  Present: ${presentNames.length}  |  Absent: ${absentNames.length}`, 20, 50);

                doc.setFont('helvetica', 'normal');
                doc.setTextColor(255,255,255);
                let y = 70;
                doc.text('Present:', 20, y); y += 8;
                presentNames.forEach((name) => {
                    if (y > 270) { doc.addPage(); y = 20; }
                    doc.text(`‚Ä¢ ${name}`, 25, y); y += 7;
                });
                y += 5;
                doc.text('Absent:', 20, y); y += 8;
                absentNames.forEach((name) => {
                    if (y > 270) { doc.addPage(); y = 20; }
                    doc.text(`‚Ä¢ ${name}`, 25, y); y += 7;
                });
                doc.save(`attendance_${cls}_${date}.pdf`);
            }

            // ADD STUDENT using the text input - NO PROMPT
            function addStudent() {
                const name = newStudentName.value.trim();
                if (!name) {
                    alert('Please enter a name in the field.');
                    return;
                }
                const cls = getCurrentClass();
                const newId = Date.now() + Math.random();
                const avatar = name.charAt(0).toUpperCase();
                classesData[cls].push({ id: newId, name, avatar, present: false });
                saveAllClasses();
                newStudentName.value = '';  // clear input
                renderStudentGrid();
            }

            function setTodayDate() {
                const today = new Date();
                const year = today.getFullYear();
                const month = String(today.getMonth() + 1).padStart(2, '0');
                const day = String(today.getDate()).padStart(2, '0');
                attendanceDate.value = `${year}-${month}-${day}`;
                globalDateSpan.innerText = today.toLocaleDateString('en-GB', { year:'numeric', month:'short', day:'numeric' });
            }

            // login
            loginBtn.addEventListener('click', (e) => {
                e.preventDefault();
                if (usernameInp.value.trim() === VALID_USER && passwordInp.value.trim() === VALID_PASS) {
                    loginBlock.style.display = 'none';
                    registerContent.style.display = 'block';
                    loadAll();
                    setTodayDate();
                    renderTeacherCard();
                    renderStudentGrid();
                    renderRegisterList();
                } else { alert('‚ùå Use Khalid / Hassan'); }
            });

            logoutBtn.addEventListener('click', () => {
                registerContent.style.display = 'none';
                loginBlock.style.display = 'block';
            });

            classSelect.addEventListener('change', () => {
                renderTeacherCard();
                renderStudentGrid();
            });

            markAllPresentBtn.addEventListener('click', markAllPresent);
            saveBtn.addEventListener('click', saveCurrentRegister);
            
            // Using the input field, not prompt
            addStudentBtn.addEventListener('click', addStudent);
            
            downloadPdfBtn.addEventListener('click', downloadPDF);
            refreshRegistersBtn.addEventListener('click', () => {
                renderRegisterList();
                refreshToCurrentClass();
            });

            attendanceDate.addEventListener('change', function() {
                if (this.value) {
                    const parts = this.value.split('-');
                    const d = new Date(parts[0], parts[1]-1, parts[2]);
                    globalDateSpan.innerText = d.toLocaleDateString('en-GB', { year:'numeric', month:'short', day:'numeric' });
                } else setTodayDate();
            });

            // Allow Enter key in the new student input to trigger add
            newStudentName.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    addStudent();
                }
            });

            setTodayDate();
        })();
    </script>
    <div style="position: fixed; bottom: 8px; left: 50%; transform: translateX(-50%); color: #bba96a; font-size: 1rem; opacity: 0.6; z-index: 10;">
        <i class="fas fa-star-and-crescent"></i> ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸéŸëŸáŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸéŸ∞ŸÜŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸêŸäŸÖŸê <i class="fas fa-star-and-crescent"></i>
    </div>
</body>
</html>
